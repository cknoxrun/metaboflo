<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>Metaboflo: <%= yield(:title) %></title>

  <%= stylesheet_link_tag 'yui', 'menu', 'application', 'tree', 'jquery-ui-1.8.13.custom' %>
  <%= yield :css %>
  
  <%= javascript_include_tag :defaults %>
  <%= javascript_include_tag 'yahoo-dom-event', 'container_core', 'menu', 'tree', 'jquery-ui-1.8.13.custom.min' %>
	
	<!-- Include YUI patches to fix scrolling issue -->
  <%= javascript_include_tag 'overlay_patch', 'menu_patch' %>

  <%= yield :javascript %>

  <script type="text/javascript">
  // Initialize and render the MenuBar when its elements are ready to be scripted.
  YAHOO.util.Event.onContentReady("navbar", function () {
    var oMenuBar = new YAHOO.widget.MenuBar("navbar", { autosubmenudisplay: true, hidedelay: 650, lazyload: true });
    oMenuBar.render();
  });
  </script>
  <%= csrf_meta_tag %>
</head>
<body class="yui-skin-sam">
  <% sidebar = !@test_subject.nil? && !@test_subject.new_record? %>

  <div id="doc3" <%= 'class="yui-t3"'.html_safe if sidebar %>> 
    <div id="hd"><!-- header -->
      <div id="headerbar">
        <%= image_tag "banner_left.jpg", :style => 'float: left' %>
        <%= image_tag "banner_right.png", :style => 'float: right' %>
      </div>

      <% if current_user %>
      <div id="navbar" class="yuimenubar yuimenubarnav">
        <div class="bd">
          <ul class="first-of-type">
            <li class="yuimenubaritem first-of-type">
              <%= link_to 'Home', root_path, :class => 'yuimenuitemlabel' %>
            </li>
            <li class="yuimenubaritem">
              <%= link_to TestSubject.title.pluralize, test_subjects_path, :class => 'yuimenubaritemlabel' %>
              <div id="test-subject" class="yuimenu">
                <div class="bd">
                  <ul>
                    <li class="yuimenuitem first-of-type"><%= link_to "All #{TestSubject.title.pluralize}", test_subjects_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem">
                      <%= link_to 'Diets', diets_path, :class => 'yuimenuitemlabel' %>
                      <div id="diets" class="yuimenu">
                        <div class="bd">
                          <ul class="first-of-type">
                            <li class="yuimenuitem first-of-type"><%= link_to 'Diets', diets_path, :class => 'yuimenuitemlabel' %></li>
  										      <li class="yuimenuitem"><%= link_to 'Ingredients', ingredients_path, :class => 'yuimenuitemlabel' %></li>
  										      <li class="yuimenuitem"><%= link_to 'Nutrients', nutrients_path, :class => 'yuimenuitemlabel' %></li>
                          </ul>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li class="yuimenubaritem">
              <%= link_to 'Wet Lab', samples_path, :class => 'yuimenubaritemlabel' %>
              <div id="wet-lab" class="yuimenu">
                <div class="bd">
                  <ul class="first-of-type">
                    <li class="yuimenuitem first-of-type"><%= link_to 'Sample Tracking', samples_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Experiments', experiments_path, :class => 'yuimenuitemlabel' %></li>
                  </ul>
                </div>
              </div>
            </li>
            <li class="yuimenubaritem"><%= link_to 'Batches', new_batches_batch_path, :class => 'yuimenubaritemlabel' %>
              <div id="tasks" class="yuimenu">
                <div class="bd">                    
                  <ul>
                    <li class="yuimenuitem"><%= link_to 'New Samples', new_batches_batch_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Sample Prep', new_batches_batch_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'pH Correction', new_batches_batch_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Run NMR', new_batches_batch_path, :class => 'yuimenuitemlabel' %></li>
                  </ul>
                </div>
              </div>                                        
            </li>
            <li class="yuimenubaritem">
              <%= link_to 'Run Experiment', new_workflows_experiment_path, :class => 'yuimenuitemlabel' %>
            </li>
            <li class="yuimenubaritem">
              <%= link_to 'Create Study', new_workflows_study_path, :class => 'yuimenuitemlabel' %>
            </li>
            <li class="yuimenubaritem">
              <%= link_to 'Analysis', studies_path, :class => 'yuimenubaritemlabel' %>
              <div id="analysis" class="yuimenu">
                <div class="bd">
                  <ul>
                    <li class="yuimenuitem"><%= link_to 'Studies', studies_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem">
                      <%= link_to 'Groups', test_subject_groupings_path, :class => 'yuimenuitemlabel' %>
                      <div id="groupings" class="yuimenu">
                        <div class="bd">                    
                          <ul>
                            <li class="yuimenuitem"><%= link_to "#{TestSubject.title} Groups", test_subject_groupings_path, :class => 'yuimenuitemlabel' %></li>
                            <li class="yuimenuitem"><%= link_to 'Sample Groups', sample_groupings_path, :class => 'yuimenuitemlabel' %></li>
                            <li class="yuimenuitem"><%= link_to 'Experiment Groups', experiment_groupings_path, :class => 'yuimenuitemlabel' %></li>
                          </ul>
                        </div>
                      </div>
                    </li>
                    <li class="yuimenuitem"><a class="yuimenuitemlabel" href="#tools">Tools</a>
                      <div id="tools" class="yuimenu">
                        <div class="bd">                    
                          <ul>
                            <li class="yuimenuitem"><%= link_to 'HMDB', 'http://www.hmdb.ca/', :target => '_blank', :class => 'yuimenuitemlabel' %></li>
                            <li class="yuimenuitem"><%= link_to 'DrugBank', 'http://drugbank.ca', :target => '_blank', :class => 'yuimenuitemlabel' %></li>
                            <li class="yuimenuitem"><%= link_to 'Metabo-Analyst', 'http://www.metaboanalyst.ca', :target => '_blank', :class => 'yuimenuitemlabel' %></li>
                            <li class="yuimenuitem"><%= link_to 'PolySearch', 'http://wishart.biology.ualberta.ca/polysearch/', :target => '_blank', :class => 'yuimenuitemlabel' %></li>
                            <li class="yuimenuitem"><%= link_to 'BioSpider', 'http://biospider.ca', :target => '_blank', :class => 'yuimenuitemlabel' %></li>
                          </ul>                    
                        </div>
                      </div>                                        
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li class="yuimenubaritem">
              <%= link_to 'Metabolites', metabolites_path, :class => 'yuimenuitemlabel' %>
            </li>
            <li class="yuimenubaritem"><%= link_to 'Planning', tasks_path, :class => 'yuimenubaritemlabel' %>
              <div id="tasks" class="yuimenu">
                <div class="bd">                    
                  <ul>
                    <li class="yuimenuitem"><%= link_to 'Tasks', tasks_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'My Tasks', user_tasks_path(current_user), :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Gantt Chart', gantt_tasks_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Calendar', calendar_tasks_path, :class => 'yuimenuitemlabel' %></li>
                  </ul>                    
                </div>
              </div>                                        
            </li>
            <li class="yuimenubaritem">
              <%= link_to 'Administration', admin_path, :class => 'yuimenubaritemlabel' %>
              <div id="administration" class="yuimenu">
                <div class="bd">                    
                  <ul>
                    <li class="yuimenuitem"><%= link_to 'Sites', sites_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Data file types', data_file_types_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Users', users_path, :class => 'yuimenuitemlabel' %></li>
                    <li class="yuimenuitem"><%= link_to 'Protocols', protocols_path, :class => 'yuimenuitemlabel' %></li>
                  </ul>
                </div>
              </div>                    
            </li>
          </ul> 
        </div>
      </div>
      <% end %>
    </div>  

    <div id="bd"><!-- body -->
      <% if current_user %>
      <div id="logged-in">
        Logged in as <em><%= current_user.to_s %></em> | <%= link_to 'Logout', destroy_user_session_path %>
      </div>
      <% elsif current_client %>
      <div id="logged-in">
        Logged in as <em><%= current_client.to_s %></em> | <%= link_to 'Logout', destroy_client_session_path %>
      </div>
      <% end -%>

      <div class="yui-b"><!-- Navigation block -->
        
        <% if sidebar -%>
        <div id="sidebar">
          <h2><%= TestSubject.title %> Summary</h2>
          <%= test_subject_tree(@test_subject) %>
        </div>
        <% end %>
      </div>

      <div id="yui-main"><!-- Main content block -->
        <div class="yui-b">
          <div id="main">
            <div id="flash">
              <% if flash[:notice] %><p class="notice"><%= flash[:notice] %></p><% end %>
              <% if flash[:error] %><p class="error"><%= flash[:error] %></p><% end %>
              <% if flash[:alert] %><p class="error"><%= flash[:alert] %></p><% end %>
            </div>
            <%= yield  %>
          </div>

        </div> 
      </div> 
    </div>  

    <div id="ft"><!-- footer -->


    </div>  
  </div>

</body>
</html>
